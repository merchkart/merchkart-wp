/* 
 * @author    ThemePunch <info@themepunch.com>
 * @link      http://www.themepunch.com/
 * @copyright 2019 ThemePunch
*/

;(function(){function D(){var b=r(this),a=b.data("bubbleaddon");a&&(a.destroy(),b.removeData("bubbleaddon"))}function l(b,a){if(!b)return!1;if(0===a)return b[a];for(var c=a,e=b[a];"inherit"===e;)c--,e=-1<c?b[c]:b[0];return e}function t(){var b=r(this),a=b.data("bubbleObj");if(a&&b.data("bubbleIndex")==a.slideIndex){b.data("bubbleaddon")&&D.call(this);var c=a.levels,e=c.length,k=H.width(),g=0;if(c)for(var f=0;f<e;f++){var q=c[f];if(E!==q){k<q&&(g=f);var E=q}}c=a.layerW[g];e=a.layerH[g];e="100%"===e||
"full"===e;"100%"!==c&&"full"!==c?c=parseInt(a.layr.css("width"),10):(c=!a.carousel||a.isStatic?a.slider:a.slotholder,a.fullAlign?(c=c.width(),a.wrapper[0].style.left=0):(c=Math.min(a.slider.width()/a.grids[g],1),c*=a.grids[g]));e?(e=a.isStatic?a.slider.height():a.slotholder.height(),a.wrapper[0].style.top=0):e=parseInt(a.layr.css("height"),10);k=l(a.blurStrength,g);E=l(a.borderSize,g);q=l(a.borderColor,g);f=l(a.blurColor,g);var F=l(a.blurX,g),z=l(a.blurY,g),x=l(a.bufferX,g),u=l(a.bufferY,g),h=l(a.numBubbles,
g),m=l(a.velX,g);g=l(a.velY,g);a=L(c,e,a.slider,a.canvas,parseInt(h,10),a.color,parseInt(k,10),f,parseInt(F,10),parseInt(z,10),q,parseInt(E,10),parseInt(x,10),parseInt(u,10),parseFloat(m),parseFloat(g));b.data("bubbleaddon",a);b.data("bubblesplaying")&&I(a,b)}}function I(b,a){b.pause=!1;b.screen.resize();b.started||(b.started=!0,b.inited());a.data("bubblesplaying",!0);b.play()}function J(b,a){this.slider=b;this.carousel=a;b.one("revolution.slide.onloaded",this.onLoaded.bind(this)).one("rsBubbleMorphDestroyed",
this.destroy.bind(this))}function K(b){for(var a=b.colors,c=a.length,e=[],k,g=0;g<c;g++){var f=a[g];delete f.align;k?JSON.stringify(f)!==JSON.stringify(k)&&(e[e.length]=f):e[e.length]=f;k=f}b.colors=e;return b}function M(b){if("object"===typeof b)return b=K(b),[b,!0];if("transparent"===b.trim())return["#FFFFFF",!1];if(-1!==b.search(/\[\{/))try{return b=JSON.parse(b.replace(/&/g,'"')),b=K(b),[b,!0]}catch(a){return["#FFFFFF",!1]}else return-1!==b.search("#")?[b,!1]:-1!==b.search("rgba")?[b.replace(/\s/g,
"").replace(/false/g,"1"),!1]:-1!==b.search("rgb")?[b.replace(/\s/g,""),!1]:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(b)?[b,!1]:["#FFFFFF",!1]}function L(b,a,c,e,k,g,f,q,E,r,l,x,u,h,m,n){var v,y={screen:{elem:null,callback:null,ctx:null,width:0,height:0,left:0,top:0,init:function(d,a){this.elem=e;this.callback=d||null;"CANVAS"==this.elem.tagName&&(this.ctx=this.elem.getContext("2d"));this.elem.onselectstart=function(){return!1};this.elem.ondrag=function(){return!1};a&&this.resize();return this},resize:function(){var d=
this.elem;this.width=b;this.height=a;for(this.top=this.left=0;null!=d;d=d.offsetParent)this.left+=d.offsetLeft,this.top+=d.offsetTop;this.ctx&&(this.elem.width=this.width,this.elem.height=this.height);v&&(v.width=this.width,v.height=this.height);this.callback&&this.callback()},destroy:function(){for(var d in this)this.hasOwnProperty(d)&&delete this[d]}}},A=function(d,a){this.x=d;this.y=a;this.magnitude=d*d+a*a;this.force=this.computed=0};A.prototype.add=function(d){return new A(this.x+d.x,this.y+
d.y)};var F=function(d){this.vel=new A((.5<Math.random()?1:-1)*(.2+Math.random()*m),(.5<Math.random()?1:-1)*(.2+Math.random()*n));this.pos=new A(.2*d.width+Math.random()*d.width*.6,.2*d.height+Math.random()*d.height*.6);this.size=d.wh/15+d.wh/15*(1.4*Math.random()+.1);this.width=d.width;this.height=d.height};F.prototype.move=function(){this.pos.x>=this.width-this.size-u?(0<this.vel.x&&(this.vel.x=-this.vel.x),this.pos.x=this.width-this.size-u):this.pos.x<=this.size+u&&(0>this.vel.x&&(this.vel.x=-this.vel.x),
this.pos.x=this.size+u);this.pos.y>=this.height-this.size-h?(0<this.vel.y&&(this.vel.y=-this.vel.y),this.pos.y=this.height-this.size-h):this.pos.y<=this.size+h&&(0>this.vel.y&&(this.vel.y=-this.vel.y),this.pos.y=this.size+h);this.pos=this.pos.add(this.vel)};var C=function(d,a,b,e){this.step=5;this.width=d;this.height=a;this.wh=Math.min(d,a);this.sx=Math.floor(this.width/this.step);this.sy=Math.floor(this.height/this.step);this.paint=!1;this.metaFill=z(d,a,e);this.plx=[0,0,1,0,1,1,1,1,1,1,0,1,0,0,
0,0];this.ply=[0,0,0,0,0,0,1,0,0,1,1,1,0,1,0,1];this.mscases=[0,3,0,3,1,3,0,3,2,2,0,2,1,1,0];this.ix=[1,0,-1,0,0,1,0,-1,-1,0,1,0,0,1,1,0,0,0,1,1];this.grid=[];this.balls=[];this.iter=0;this.sign=1;for(d=0;d<(this.sx+2)*(this.sy+2);d++)this.grid[d]=new A(d%(this.sx+2)*this.step,Math.floor(d/(this.sx+2))*this.step);for(d=0;d<b;d++)this.balls[d]=new F(this)};C.prototype.destroy=function(){for(var d in this.balls)this.balls.hasOwnProperty(d)&&delete this.balls[d];for(d in this)this.hasOwnProperty(d)&&
delete this[d]};C.prototype.computeForce=function(d,a,b){b=b||d+a*(this.sx+2);if(0===d||0===a||d===this.sx||a===this.sy)d=.6*this.sign;else{d=0;a=this.grid[b];if(!a)return;for(var e=0,B;B=this.balls[e++];)d+=B.size*B.size/(-2*a.x*B.pos.x-2*a.y*B.pos.y+B.pos.magnitude+a.magnitude);d*=this.sign}if(this.grid[b])return this.grid[b].force=d};C.prototype.marchingSquares=function(a){var b=a[0],d=a[1],e=a[2];a=b+d*(this.sx+2);if(this.grid[a]){if(this.grid[a].computed===this.iter)return!1;for(var c,g=0,f=
0;4>f;f++){var k=b+this.ix[f+12]+(d+this.ix[f+16])*(this.sx+2);if(!this.grid[k]){c=!0;break}var h=this.grid[k].force;if(0<h&&0>this.sign||0>h&&0<this.sign||!h)h=this.computeForce(b+this.ix[f+12],d+this.ix[f+16],k);1<Math.abs(h)&&(g+=Math.pow(2,f))}if(!c){if(15===g)return[b,d-1,!1];if(5===g)c=2===e?3:1;else if(10===g)c=3===e?0:2;else{c=this.mscases[g];if(!this.grid[a])return;this.grid[a].computed=this.iter}a=this.step/(Math.abs(Math.abs(this.grid[b+this.plx[4*c+2]+(d+this.ply[4*c+2])*(this.sx+2)].force)-
1)/Math.abs(Math.abs(this.grid[b+this.plx[4*c+3]+(d+this.ply[4*c+3])*(this.sx+2)].force)-1)+1);p.lineTo(this.grid[b+this.plx[4*c]+(d+this.ply[4*c])*(this.sx+2)].x+this.ix[c]*a,this.grid[b+this.plx[4*c+1]+(d+this.ply[4*c+1])*(this.sx+2)].y+this.ix[c+4]*a);this.paint=!0;return[b+this.ix[c+4],d+this.ix[c+8],c]}}};C.prototype.renderMetaballs=function(){for(var a=0,b;b=this.balls[a++];)b.move();this.iter++;this.sign=-this.sign;this.paint=!1;p.fillStyle=this.metaFill;f&&(p.shadowBlur=f,p.shadowColor=q,
p.shadowOffsetX=E,p.shadowOffsetY=r);x&&(p.strokeStyle=l,p.lineWidth=x);p.beginPath();for(a=0;b=this.balls[a++];){b=[Math.round(b.pos.x/this.step),Math.round(b.pos.y/this.step),!1];do b=this.marchingSquares(b);while(b);this.paint&&(p.fill(),p.closePath(),x&&p.stroke(),p.beginPath(),this.paint=!1)}};var z=function(a,b,c){if(c[1]){c=c[0];if("radial"===c.type){var d=c.colors;var e=.5*a;a=.5*b;e=p.createRadialGradient(e,a,0,e,a,e);a=d.length;for(c=0;c<a;c++)b=d[c],e.addColorStop(.01*b.position,"rgba("+
b.r+", "+b.g+", "+b.b+", "+b.a+")");return e}e=p;d=c.colors;c=c.angle;var g=0,f=0,k=0,h=0;c=parseInt(c,10);if(/0|90|180|270|360/.test(c))switch(c){case 0:case 360:f=b;break;case 90:k=a;break;case 180:h=b;break;case 270:g=a}else a*=.5,b*=.5,h=Math.PI/180*(c-180),c=b/Math.cos(h),c+=Math.sin(h)*(a-Math.sqrt(c*c-b*b)),g=a+Math.cos(-Math.PI/2+h)*c,f=b+Math.sin(-Math.PI/2+h)*c,k=a+Math.cos(Math.PI/2+h)*c,h=b+Math.sin(Math.PI/2+h)*c;e=e.createLinearGradient(Math.round(g),Math.round(f),Math.round(k),Math.round(h));
c=d.length;for(g=0;g<c;g++)a=d[g],b=parseInt(a.position,10),e.addColorStop(.01*b,"rgba("+a.r+", "+a.g+", "+a.b+", "+a.a+")");return e}return c[0]},t=function(){G&&!G.pause&&(p.clearRect(0,0,w.width,w.height),v.renderMetaballs(),requestAnimationFrame(t))},w=y.screen.init(null,!0),p=w.ctx,D=function(){v=new C(w.width,w.height,k,g)},G={play:t,pause:!1,screen:w,inited:D,started:!1,destroy:function(){G.pause=!0;cancelAnimationFrame(t);p.clearRect(0,0,w.width,w.height);v&&v.destroy();w.destroy();p=z=D=
G=w=t=C=F=A=y=v=null}};return G}var r,H;window.BubbleMorphAddOn=function(b,a,c){if(b&&a)return r=b,H=r(window),r.event.special.rsBubbleMorphDestroyed={remove:function(a){a.handler()}},new J(a,c)};J.prototype={onLoaded:function(){var b,a=this.slider,c=this.carousel;if(b=r.fn.revolution&&r.fn.revolution[a[0].id]?r.fn.revolution[a[0].id]:!1){var e=b.gridwidth,k=b.responsiveLevels;for(Array.isArray(e)||(e=[e]);4>e.length;)e[e.length]=e[e.length-1];for(b=0;4>b;b++)e[b]=parseInt(e[b],10);if(k){for(Array.isArray(k)||
(k=[k]);4>k.length;)k[k.length]=k[k.length-1];for(b=0;4>b;b++)k[b]=parseInt(k[b],10)}this.morph=a.find(".tp-bubblemorph").each(function(){var b=r(this),f=b.attr("data-bubblemorph");try{f=JSON.parse(f)}catch(A){return}var q=r("<canvas />").appendTo(b),l=f.num,t=f.speedx,z=f.speedy,x=f.bufferx,u=f.buffery,h=b.attr("data-dim");if(h){h=h.split(";");for(var m=!1,n=!1,v=h.length,y=0;y<v&&("w"===h[y].charAt(0).toLowerCase()?m=h[y].replace("w:","").split(","):"h"===h[y].charAt(0).toLowerCase()&&(n=h[y].replace("h:",
"").split(",")),!1===m||!1===n);y++);if(!1!==m&&!1!==n){for(;4>m.length;)m[m.length]=m[m.length-1];for(;4>n.length;)n[n.length]=n[n.length-1];for(;n.length<m.length;)n[n.length]=n[n.length-1];for(;m.length<n.length;)n[m.length]=m[m.length-1];l=l.split("|");x=x.split("|");u=u.split("|");t=t.split("|");z=z.split("|");h=b.closest("rs-slide");q={velX:t,velY:z,layr:b,grids:e,layerW:m,layerH:n,slider:a,levels:k,bufferX:x,bufferY:u,canvas:q[0],carousel:c,numBubbles:l,wrapper:b.closest("rs-layer-wrap"),isStatic:b.hasClass("rs-layer-static"),
color:M(f.bg),fullAlign:"slide"===this.getAttribute("data-basealign"),slotholder:h.find("rs-sbg-wrap"),slideIndex:parseInt(h.attr("data-originalindex"),10)};if(l=f.blur)q.blurStrength=l.split("|"),q.blurColor=f.blurcolor.split("|"),q.blurX=f.blurx.split("|"),q.blurY=f.blury.split("|");if(l=f.bordersize)q.borderSize=l.split("|"),q.borderColor=f.bordercolor.split("|");b.data("bubbleObj",q)}}});if(this.morph.length)a.on("revolution.slide.onbeforeswap",this.beforeChange.bind(this)).on("revolution.slide.afterdraw",
this.onResize.bind(this)).on("revolution.slide.layeraction",this.layerAction.bind(this));else this.destroy()}},beforeChange:function(b,a){this.slider.find(".tp-bubblemorph").data("bubbleIndex",parseInt(a.nextSlideIndex,10))},createBubbles:function(){this.morph.each(t)},onResize:function(b){clearTimeout(this.resizeTimer);this.morph.each(D);this.resizeTimer=setTimeout(this.resize.bind(this),250)},resize:function(){this.morph.each(t)},layerAction:function(b,a){var c=a.layer.data("bubbleaddon");if(!c)if(a.layer.hasClass("tp-bubblemorph"))t.call(a.layer);
else return;if(c=a.layer.data("bubbleaddon"))switch(c.screen&&c.screen.width&&c.screen.height||(t.call(a.layer),c=a.layer.data("bubbleaddon")),a.eventtype){case "enterstage":I(c,a.layer);break;case "leftstage":var e=a.layer;c.pause=!0;e.data("bubblesplaying",!1)}},checkRemoved:function(){return this.slider&&document.body.contains(this.slider[0])?!1:(this.destroy(),!0)},destroy:function(){this.slider.find(".tp-bubblemorph").each(function(){var a=r(this);a.data("bubbleaddon").pause=!0;a.removeData("bubbleaddon bubbleObj")});
for(var b in this)this.hasOwnProperty(b)&&delete this[b]}}})();